#include <stdio.h>
#include <string.h>

#define MAX_TRANSACTIONS 5

int main() {
    const int correctPIN = 1234;  
    int enteredPIN;
    int attempts = 0;
    float balance = 1000.00;
    float amount;
    int choice;
    
    // Transaction history array
    char transactions[MAX_TRANSACTIONS][50];
    int transactionCount = 0;

    // PIN Login
    while (attempts < 3) {
        printf("Enter your 4-digit PIN: ");
        if (scanf("%d", &enteredPIN) != 1) {
            printf("Invalid input! Numbers only.\n");
            while (getchar() != '\n');
            continue;
        }
        if (enteredPIN == correctPIN) {
            printf("PIN accepted. Welcome!\n");
            break;
        } else {
            attempts++;
            printf("Incorrect PIN! Attempts left: %d\n", 3 - attempts);
        }
    }
    if (attempts == 3) {
        printf("Too many failed attempts. Exiting...\n");
        return 0;
    }

    // Main ATM loop
    while (1) {
        printf("\n===============================\n");
        printf("          ATM MACHINE\n");
        printf("===============================\n");
        printf("1. Check Balance\n");
        printf("2. Deposit\n");
        printf("3. Withdraw\n");
        printf("4. Transaction History\n");
        printf("5. Exit\n");
        printf("-------------------------------\n");
        printf("Choose an option (1-5): ");

        if (scanf("%d", &choice) != 1) {
            printf("Invalid input! Numbers only.\n");
            while (getchar() != '\n');
            continue;
        }

        switch (choice) {
            case 1:
                printf("\nYour current balance: ₱%.2f\n", balance);
                break;

            case 2:
                printf("\nEnter amount to deposit: ");
                if (scanf("%f", &amount) != 1) {
                    printf("Invalid input! Numbers only.\n");
                    while (getchar() != '\n');
                    continue;
                }
                if (amount <= 0) {
                    printf("Deposit must be greater than 0.\n");
                } else {
                    balance += amount;
                    printf("Successfully deposited ₱%.2f\n", amount);
                    // Add to transaction history
                    snprintf(transactions[transactionCount % MAX_TRANSACTIONS], 50, "Deposited: ₱%.2f", amount);
                    transactionCount++;
                }
                break;

            case 3:
                printf("\nEnter amount to withdraw: ");
                if (scanf("%f", &amount) != 1) {
                    printf("Invalid input! Numbers only.\n");
                    while (getchar() != '\n');
                    continue;
                }
                if (amount <= 0) {
                    printf("Withdrawal must be greater than 0.\n");
                } else if (amount > balance) {
                    printf("Insufficient balance! You only have ₱%.2f\n", balance);
                } else {
                    balance -= amount;
                    printf("Successfully withdrew ₱%.2f\n", amount);
                    // Add to transaction history
                    snprintf(transactions[transactionCount % MAX_TRANSACTIONS], 50, "Withdrew: ₱%.2f", amount);
                    transactionCount++;
                }
                break;

            case 4:
                printf("\n===== Transaction History =====\n");
                if (transactionCount == 0) {
                    printf("No transactions yet.\n");
                } else {
                    int start = transactionCount > MAX_TRANSACTIONS ? transactionCount - MAX_TRANSACTIONS : 0;
                    for (int i = start; i < transactionCount; i++) {
                        printf("%s\n", transactions[i % MAX_TRANSACTIONS]);
                    }
                }
                break;

            case 5:
                printf("\nThank you for using the ATM. Goodbye!\n");
                return 0;

            default:
                printf("\nInvalid option! Choose between 1–5.\n");
        }
    }

    return 0;
}
